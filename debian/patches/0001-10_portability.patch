From: Nathan Nutter <nnutter@genome.wustl.edu>
Date: Tue, 5 Jun 2012 13:18:18 -0500
Subject: 10_portability

---
 build/Makefile.gcc   |    6 ------
 build/Makefile.shell |   16 +++++++++++-----
 2 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/build/Makefile.gcc b/build/Makefile.gcc
index 3db6bf8..63de882 100644
--- a/build/Makefile.gcc
+++ b/build/Makefile.gcc
@@ -49,12 +49,6 @@ ifeq (linux,$(OS))
     NO_ARRAY_BOUNDS_WARNING = -Wno-array-bounds
 endif
 
-ifeq (64,$(BITS))
-	CARCH = -m64
-else
-	CARCH = -m32
-endif
-
 ifeq (prof, $(BUILD))
 	PROF = -pg
 endif
diff --git a/build/Makefile.shell b/build/Makefile.shell
index 98f5a16..245ea4e 100644
--- a/build/Makefile.shell
+++ b/build/Makefile.shell
@@ -26,6 +26,7 @@
 # determine OS
 UNAME = $(shell uname -s)
 
+OS = ''
 ifeq (Darwin, $(UNAME))
 	OS = mac
 endif
@@ -41,11 +42,16 @@ endif
 ifeq (xMINGW, $(findstring xMINGW,x$(UNAME)))
 	OS = win
 endif
+# handle all other OSes (like BSD or Hurd) as if they were linux (see bug #627861)
+ifeq ($(OS), '')
+	OS = linux
+endif
 
 # OS flavor is normally OS
 OSFLAV = $(OS)
 
 # determine ARCH
+ARCH = ''
 ifeq (mac,$(OS))
 	ARCH = $(shell $(TOP)/build/mac.arch.sh)
 else
@@ -80,13 +86,13 @@ else
 		ARCH = sparc32
 	endif
 endif
+# Handle all other architectures equivalent as i386 (see bug #627861)
+ifeq ($(ARCH),'')
+	ARCH = i386
+endif
 
 # determine BITS
-ifeq (x86_64, $(ARCH))
-	BITS = 64
-else
-	BITS = 32
-endif
+BITS = $(shell dpkg-architecture -qDEB_BUILD_ARCH_BITS)
 
 # first pass through defines SRCDIR
 ifndef SRCDIR
-- 
